<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Community Groups</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ðŸ’¬ Community Groups</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGroupModal">+ Create Group</button>
  </div>

  <div id="groupsContainer" class="row g-3"></div>
</div>

<!-- Create Group Modal -->
<div class="modal fade" id="createGroupModal" tabindex="-1" aria-labelledby="createGroupLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <h5 class="modal-title mb-3">Create a Group</h5>
      <form id="createGroupForm">
        <div class="mb-3">
          <label class="form-label">Group Name</label>
          <input type="text" id="groupName" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea id="groupDesc" class="form-control" rows="2"></textarea>
        </div>
        <button type="submit" class="btn btn-success w-100">Create</button>
      </form>
    </div>
  </div>
</div>

<script>
const token = localStorage.getItem("authToken"); // JWT token
const baseUrl = "http://127.0.0.1:8000/api/groups/";

async function loadGroups() {
  // const res = await fetch(baseUrl, { headers: { Authorization: `Bearer ${token}` }});
  const res = await fetch(baseUrl, { headers: { "Authorization": token ? "Bearer " + token : "" }});
  const data = await res.json();
  const container = document.getElementById("groupsContainer");
  container.innerHTML = "";
  data.forEach(group => {
    container.innerHTML += `
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5>${group.name}</h5>
            <p class="text-muted small">${group.description || ""}</p>
            <a href="community.html?slug=${group.slug}" class="btn btn-outline-primary w-100">Join Chat</a>
          </div>
        </div>
      </div>`;
  });
}

document.getElementById("createGroupForm").addEventListener("submit", async e => {
  e.preventDefault();
  const payload = { name: groupName.value, description: groupDesc.value };
  await fetch(baseUrl, {
    method: "POST",
    headers: { 
      "Content-Type": "application/json",
      "Authorization": token ? "Bearer " + token : ""
    },
    body: JSON.stringify(payload)
  });
  document.getElementById("createGroupModal").classList.remove("show");
  loadGroups();
});

loadGroups();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
