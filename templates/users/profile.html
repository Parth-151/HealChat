{% extends "users/sidebar_base.html" %}
{% load static %}

{% block title %}{{ user_obj.username }} | Profile{% endblock %}

{% block content %}
<div class="card shadow-sm p-4 mb-4">

    <div class="d-flex flex-column flex-md-row align-items-center gap-4">

        <!-- Avatar -->
        <div class="text-center">
            {% if profile.avatar and profile.avatar.url %}
                <img src="{{ profile.avatar.url }}" class="rounded-circle shadow-sm" style="width:160px; height:160px; object-fit:cover;">
            {% elif profile.preset_avatar %}
                <img src="{% static 'avatars/defaults/'|add:profile.preset_avatar %}" class="rounded-circle shadow-sm" style="width:160px; height:160px; object-fit:cover;">
            {% else %}
                <img src="{% static 'avatars/defaults/default1.png' %}" class="rounded-circle shadow-sm" style="width:160px; height:160px; object-fit:cover;">
            {% endif %}
        </div>

        <!-- Info -->
        <div class="flex-grow-1 w-100">
            <h3 class="fw-bold mb-1">{{ user_obj.get_full_name|default:user_obj.username }}</h3>
            <p class="text-muted mb-2">{{ user_obj.email }}</p>
            <p class="mb-3">{{ profile.bio|default:"No bio added yet." }}</p>

            {% if is_owner %}
                <a href="{% url 'users:edit_profile' %}" class="btn btn-primary btn-sm me-2">Edit Profile</a>
                <a href="{% url 'users:choose_avatar' %}" class="btn btn-outline-secondary btn-sm">Choose Avatar</a>
            {% else %}
                <a href="{% url 'chat:private_chat' user_obj.username %}" class="btn btn-primary btn-sm">Message</a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Analysis + Groups Section -->
<div class="row g-3">
    <div class="col-md-6">
        <div class="card shadow-sm p-3">
            <h5 class="fw-bold">Short Analysis</h5>
            <hr>
            {% if short_analysis %}
                <ul class="list-unstyled">
                    <li>Mood: <strong>{{ short_analysis.mood }}</strong></li>
                    <li>Stress: <strong>{{ short_analysis.stress }}</strong></li>
                    <li>Negative: <strong>{{ short_analysis.negative }}%</strong></li>
                </ul>
                <a href="/chatbot/analysis/" class="btn btn-outline-primary btn-sm">View full analysis</a>
            {% else %}
                <p class="text-muted">No analysis available.</p>
            {% endif %}
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm p-3">
            <h5 class="fw-bold">Groups</h5>
            <hr>
            {% if groups %}
                <ul class="list-unstyled">
                    {% for g in groups %}
                        <li><a href="/groups/{{ g.slug }}/">{{ g.name }}</a></li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">Not part of any groups.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
